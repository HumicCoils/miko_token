version: '3.8'

services:
  keeper-bot-test:
    build:
      context: .
      dockerfile: Dockerfile.test
    container_name: miko-keeper-bot-test
    environment:
      - NODE_ENV=test
      - SOLANA_RPC_URL=${SOLANA_RPC_URL}
      - ABSOLUTE_VAULT_PROGRAM=${ABSOLUTE_VAULT_PROGRAM}
      - SMART_DIAL_PROGRAM=${SMART_DIAL_PROGRAM}
      - MIKO_TOKEN_MINT=${MIKO_TOKEN_MINT}
      - TREASURY_WALLET=${TREASURY_WALLET}
      - OWNER_WALLET=${OWNER_WALLET}
      - KEEPER_BOT_PRIVATE_KEY=${KEEPER_BOT_PRIVATE_KEY}
      - MIN_HOLDER_BALANCE=100000000000000
      - SKIP_PRICE_CHECKS=true
      - SKIP_SWAPS=true
      - USE_MOCK_TWITTER=true
      - RUN_IMMEDIATELY=true
      - HEALTH_CHECK_PORT=3000
      - LOG_LEVEL=debug
    ports:
      - "3001:3000"  # Different port to avoid conflict with production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    volumes:
      - ./logs:/app/logs
    networks:
      - miko-test-network

networks:
  miko-test-network:
    driver: bridge