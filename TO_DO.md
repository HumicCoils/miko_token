# MIKO Token Development Checklist - Final Architecture

## Core Development Principles

1. **Programs First, Token Second**: Deploy programs to get IDs before creating token
2. **Phase Isolation**: Each phase in separate Docker container
3. **No Compromises**: Production-ready architecture with anti-sniper protection
4. **Shared Artifacts**: Program IDs and critical data shared between phases
5. **Process Over Details**: Focus on correct order and verification, not specific versions

## Prerequisites

### Docker Environment Setup
- [ ] Install Docker and Docker Compose
- [ ] Create project directory structure:
  ```
  miko-token/
  â”œâ”€â”€ docker/
  â”‚   â”œâ”€â”€ phase1-programs/
  â”‚   â”œâ”€â”€ phase2-token/
  â”‚   â”œâ”€â”€ phase3-init/
  â”‚   â”œâ”€â”€ phase4-keeper/
  â”‚   â””â”€â”€ shared-artifacts/
  â”œâ”€â”€ PLAN.md
  â”œâ”€â”€ TO_DO.md
  â”œâ”€â”€ testing_strategy.md
  â””â”€â”€ README.md
  ```
- [ ] Understand volume mounting for artifact sharing

## Phase 1: Core Programs Development âœ… COMPLETE

### Container Setup
- [x] Create Dockerfile with Rust, Solana, and Anchor âœ…
- [x] Configure docker-compose.yml with shared-artifacts volume âœ…
- [x] Verify SPL Token-2022 dependencies work âœ…

### Absolute Vault Program Development
- [x] Initialize Anchor workspace for programs âœ…
- [x] Generate program keypair BEFORE coding âœ…
- [x] Update declare_id! with keypair address âœ…
- [x] Implement VaultState with: âœ…
  - [x] Multi-token support via mint-based PDA derivation âœ…
  - [x] Dual exclusion lists (fee_exclusions, reward_exclusions) âœ…
  - [x] Launch timestamp tracking âœ…
  - [x] Fee finalization flag âœ…
  - [x] Harvest threshold (500k MIKO) âœ…
  - [x] Emergency withdrawal capabilities âœ…
  - [x] Batch operation support âœ…
  
- [x] Implement instructions with direct CPI: âœ…
  - [x] `initialize` - Set up vault with auto-exclusions âœ…
  - [x] `set_launch_time` - Record Raydium pool creation timestamp âœ…
  - [x] `update_transfer_fee` - Handle 30% â†’ 15% â†’ 5% transitions âœ…
  - [x] `harvest_fees` - Using SPL Token harvest instruction âœ…
  - [x] `distribute_rewards` - With SOL balance management âœ…
  - [x] `manage_exclusions` - Add/remove from lists âœ…
  - [x] `update_config` - Modify vault parameters âœ…
  - [x] `emergency_withdraw_vault` - Withdraw tokens/SOL âœ…
  - [x] `emergency_withdraw_withheld` - Recover stuck fees âœ…

- [x] Build and deploy with proper ID management: âœ…
  - [x] Run anchor build âœ…
  - [x] Deploy to devnet using generated keypair âœ…
  - [x] Verify: deployed ID = declared ID in code âœ… (4ieMsf7qFmh1W5FwcaX6M3fz3NNyaGy3FyuXoKJLrRDq)
  - [x] Save program ID to shared-artifacts âœ…
  - [x] Record deployment timestamp âœ… (2025-07-15)

### Smart Dial Program Development
- [x] Generate program keypair BEFORE coding âœ…
- [x] Update declare_id! with keypair address âœ…
- [x] Implement DialState with: âœ…
  - [x] Current reward token storage (default SOL) âœ…
  - [x] Launch timestamp for first Monday calculation âœ…
  - [x] Update history tracking âœ…
  - [x] 24-hour update constraint (after first Monday) âœ…
  
- [x] Implement instructions: âœ…
  - [x] `initialize` - Set SOL as initial reward token âœ…
  - [x] `update_reward_token` - Change reward token (Monday only) âœ…
  - [x] `update_treasury` - Modify treasury wallet âœ…
  - [x] `update_authority` - Transfer authority control âœ…

- [x] Build, deploy with same keypair, and verify ID match âœ… (DggkQFbBnkMCK43y5JTHfYdX3CKw2H3m177TbLC7Mjdz)
- [x] Save program ID to shared-artifacts âœ…

### Phase 1 Validation
- [x] Both programs successfully deployed âœ…
- [x] Program IDs saved to shared-artifacts âœ…
- [x] Verify all declared IDs match deployed IDs âœ…
- [x] No compilation errors with Token-2022 integration âœ…

## Phase 2: MIKO Token Creation âœ… COMPLETE

### Container Setup
- [x] Create a new environment dedicated to Phase 2 âœ…
- [x] Mount shared-artifacts to access program IDs âœ…

### Pre-Creation Verification
- [x] Load all program IDs from shared-artifacts âœ…
- [x] Verify both programs are deployed and accessible âœ…
- [x] Test connection to each program (query account info) âœ…

### Token Creation Script Development
- [x] Create comprehensive token creation script that: âœ…
  - [x] Loads all program IDs from shared-artifacts âœ…
  - [x] Generates new mint keypair âœ…
  - [x] Creates mint with deployer as temporary authorities âœ…
  - [x] Sets freeze authority to null (permanent) âœ…
  - [x] Initializes with 30% transfer fee (3000 basis points) âœ…
  - [x] Mints total supply of 1,000,000,000 MIKO âœ…
  - [x] Stores tokens in deployer wallet temporarily âœ…

### Execute Token Creation
- [x] Run token creation script âœ…
- [x] Verify mint created with correct parameters âœ…
- [x] **VC:2.NO_UNSUPPORTED_EXT** âœ…
  - [x] Verify only TransferFeeConfig extension present âœ…
  - [x] Confirm NO transfer hook or other incompatible extensions âœ…
  - [x] Write `verification/vc2-no-unsupported-ext.json` âœ…
  - [x] PASS required before Phase 3 âœ… PASSED
- [x] **VC:2.FEE_RATE** âœ…
  - [x] Query mint for TransferFeeConfig extension âœ…
  - [x] Verify fee = 3000 basis points (30%) âœ…
  - [x] Write `verification/vc2-fee-rate.json` âœ…
  - [x] PASS required before proceeding âœ… PASSED
- [x] **VC:2.AUTHORITIES** âœ…
  - [x] Verify all authorities = deployer wallet âœ…
  - [x] Verify freeze authority = null âœ…
  - [x] Write `verification/vc2-authorities.json` âœ…
  - [x] PASS required before Phase 3 âœ… PASSED

### Phase 2 Documentation
- [x] Total supply minted and in deployer wallet âœ…
- [x] Mint authority still with deployer (temporary) âœ…
- [x] Transfer fee config authority with deployer (temporary) âœ…
- [x] Withdraw withheld authority with deployer (temporary) âœ…
- [x] Save comprehensive token info to shared-artifacts âœ…

## Phase 3: System Initialization & Authority Transfer âœ… COMPLETE

### Container Setup
- [x] Create initialization environment âœ…
- [x] Access program IDs and token info from shared-artifacts âœ…

### Calculate PDAs
- [x] Calculate Vault PDA using mint address and 'vault' seed âœ…
- [x] Save PDA addresses for use in transfers âœ…
- [x] **VC:3.PDA_CALCULATION** âœ…
  - [x] Verify PDA calculation is deterministic âœ…
  - [x] Write `verification/vc3-pda-calculation.json` âœ…
  - [x] PASS required before initialization âœ… PASSED

### Critical Order: Initialize Programs BEFORE Authority Transfers
- [x] **Step 1**: Initialize Vault (creates PDA) âœ…
  - [x] Create initialization script âœ…
  - [x] Initialize vault with all parameters âœ…
  - [x] Verify PDA created successfully âœ…
  - [x] Verify auto-exclusions applied: âœ…
    - [x] Owner wallet excluded âœ…
    - [x] Treasury excluded âœ…
    - [x] Keeper wallet excluded âœ…
    - [x] Vault program excluded âœ…
    - [x] Vault PDA excluded âœ…
  - [x] **VC:3.VAULT_EXCLUSIONS** âœ…
    - [x] Query vault account data âœ…
    - [x] Verify all 5 system accounts in both exclusion lists âœ…
    - [x] Write `verification/vc3-vault-exclusions.json` âœ…
    - [x] PASS required before Step 2 âœ… PASSED

- [x] **Step 2**: Initialize Smart Dial âœ…
  - [x] Set initial reward token to SOL âœ…
  - [x] Configure treasury wallet âœ…
  - [x] Record initialization timestamp âœ…
  - [x] Verify dial state PDA created âœ…
  - [x] Set update constraints âœ…

### Verify All PDAs Exist Before Proceeding
- [x] Vault PDA exists and initialized âœ…
- [x] Dial state PDA exists âœ…
- [x] DO NOT proceed to authority transfers if any PDA missing âœ…

### Authority Transfers (Only After ALL PDAs Exist)
- [x] Transfer fee config authority from deployer to Vault PDA âœ…
- [x] Transfer withdraw withheld authority from deployer to Vault PDA âœ…
- [x] Verify each transfer successful âœ…
- [x] **VC:3.AUTH_SYNC** âœ…
  - [x] Fetch mint account and verify all Token-2022 authorities âœ…
  - [x] Both authorities must equal Vault PDA âœ…
  - [x] Write `verification/vc3-auth-sync.json` âœ…
  - [x] PASS required before transfers âœ… PASSED

### Initial Transfer Testing
- [x] Test small transfer between test wallets âœ…
- [x] Verify 30% fee is collected âœ…
- [x] Verify fees accumulate as withheld amounts âœ…
- [x] **VC:3.TRANSFER_TEST** âœ…
  - [x] Use STANDARD SPL token transfer (NO custom scripts) âœ…
  - [x] Send 100 MIKO: verify receiver gets 70, 30 withheld âœ…
  - [x] Must use same transfer method as wallets/DEXs âœ…
  - [x] Write `verification/vc3-transfer-test.json` âœ…
  - [x] PASS required before proceeding âœ… PASSED

### Finalize Token Setup
- [x] Revoke mint authority permanently âœ…
- [x] Verify mint authority is null âœ…

### Token Distribution
- [x] Send tokens from deployer wallet to: âœ…
  - [x] Keep liquidity allocation in deployer wallet âœ… (90% for LP + 10% retention)
  - [x] Team wallets (if applicable) âœ… (No team allocation)
  - [x] Marketing wallet (if applicable) âœ… (No marketing allocation)
- [x] Verify all non-liquidity tokens distributed âœ…
- [x] Ensure deployer retains only liquidity allocation âœ…

### Phase 3 Testing
- [x] Test dynamic fee collection (30% rate) âœ…
- [x] Test vault can harvest fees with PDA signature âœ…
- [x] Verify exclusion lists work correctly âœ…
- [x] Verify all authorities properly transferred âœ…
- [x] Run full integration test suite âœ…

## Phase 4: Integration & Pre-Flight ğŸ”„ IN PROGRESS

**Testing Strategy**: Follow the approach in testing_strategy.md - Mock CI Tests â†’ Local Mainnet-Fork â†’ Mainnet Canary

### Phase 4-A: Mock CI Tests âœ… COMPLETED

#### Mock Environment Setup
- [x] Create `mock_config.toml` with:
  - [x] Mock RPC endpoints
  - [x] Test program IDs
  - [x] Mock API keys
  - [x] Test keeper wallet
- [x] Set up MockRaydiumAdapter (see testing_strategy.md Section 2) - CODE WRITTEN
- [x] Set up MockJupiterAdapter - CODE WRITTEN
- [x] Set up MockBirdeyeAdapter - CODE WRITTEN

#### Keeper Bot Development
- [x] **Fee Update Manager** âœ… TESTED
  - [x] Track launch timestamp
  - [x] Schedule update at launch + 5 minutes (30% â†’ 15%)
  - [x] Schedule update at launch + 10 minutes (15% â†’ 5%)
  - [x] Implement fee finalization logic
  - [x] Add authority revocation after 10 minutes

- [x] **Twitter Monitor** (Active after first Monday) âœ… TESTED
  - [x] Calculate first Monday after launch
  - [x] Implement Twitter API v2 integration (mock)
  - [x] At Monday 03:00 UTC, fetch @project_miko's pinned tweet
  - [x] Extract single $SYMBOL mention from pinned message
  - [x] Handle case where no pinned tweet or no symbol found
  - [x] **VC:4.FIRST_MONDAY** âœ…
    - [x] Test calculation with multiple launch dates âœ…
    - [x] Verify Monday detection logic âœ…
    - [x] Test edge cases (launch on Monday, Sunday, etc.) âœ…
    - [x] Write `verification/vc4-first-monday.json` âœ…
    - [x] PASS required before Twitter integration âœ… PASSED

- [x] **Token Selector** âœ… TESTED
  - [x] Integrate Birdeye API (mock)
  - [x] Default to SOL before first Monday
  - [x] Query all tokens matching the mentioned symbol
  - [x] Compare 24h volumes for all tokens with same symbol
  - [x] Select the one with highest 24h volume
  - [x] Update Smart Dial program with selected token

- [x] **Fee Harvester** âœ… TESTED
  - [x] Query all MIKO token accounts
  - [x] Calculate total withheld fees
  - [x] Monitor for 500k MIKO threshold
  - [x] Batch accounts for efficient harvesting
  - [x] Call vault's harvest_fees when threshold reached
  - [x] Trigger swap and distribution after harvest

- [x] **Swap Manager** âœ… TESTED
  - [x] Integrate Jupiter API (mock)
  - [x] Handle tax splitting (20% to owner, 80% to holders)
  - [x] Manage SOL balance for keeper operations
  - [x] Execute swaps with slippage protection

- [x] **Distribution Engine** âœ… TESTED
  - [x] Query holders via Birdeye API (mock)
  - [x] Calculate USD values for eligibility
  - [x] Filter $100+ holders
  - [x] Execute proportional distribution
  - [x] Implement Tax Flow Scenarios

#### Mock Testing Execution âœ… COMPLETED
- [x] Build Docker container âœ…
- [x] Run `phase4-mock` test suite âœ…
- [x] Test keeper rollback on failures âœ…
- [x] Test concurrent harvest protection âœ…
- [x] Test edge cases: âœ…
  - [x] Keeper balance = exactly 0.05 SOL âœ…
  - [x] Swap failures âœ…
  - [x] API timeouts âœ…
- [x] **VC:4.TAX_FLOW_EDGE** âœ…
  - [x] Test rollback scenarios with transaction failures âœ…
  - [x] Test slippage protection with high volatility âœ…
  - [x] Test concurrent harvest protection âœ…
  - [x] Test recovery logic with exponential backoff âœ…
  - [x] Write `verification/vc4-tax-flow-edge.json` âœ…
  - [x] PASS required for production âœ… PASSED
- [x] **VC:4.KEEPER_PREFLIGHT** âœ…
  - [x] Verify environment setup âœ…
  - [x] Test RPC connections âœ…
  - [x] Verify program reachability âœ…
  - [x] Write `verification/vc4-keeper-preflight.json` âœ… PASSED

### Phase 4-B: Local-Fork Simulation â³ AWAITING 4-A

**Testing Approach**: Use Local Mainnet-Fork as documented in testing_strategy.md Section 3

#### Local Mainnet-Fork Setup
- [x] Web search for current Raydium CLMM program ID âœ… (CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK)
- [x] Web search for current Jupiter aggregator program ID âœ… (JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4)
- [x] Configure solana-test-validator with: âœ…
  - [x] `--url https://api.mainnet-beta.solana.com` âœ…
  - [x] `--clone CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK` âœ…
  - [x] `--clone JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4` âœ…
  - [x] `--clone So11111111111111111111111111111111111111112` âœ…
  - [x] `--hard-fork <SPECIFIC_SLOT_NUMBER>` âœ…

#### Launch Script Development
- [x] Create launch coordination script with: âœ…
  - [x] Pre-launch checklist verification âœ…
  - [x] Raydium CLMM pool creation function âœ… (simulated, needs Raydium SDK integration)
  - [x] Launch Liquidity Ladder execution logic (refer to LAUNCH_LIQUIDITY_PARAMS.md) âœ…
  - [x] Immediate launch timestamp setter âœ…
  - [x] Fee update scheduler initialization âœ…
  - [x] Keeper bot startup trigger âœ…
  - [x] Oracle price fetch requirement âœ…
  - [x] Distribution Engine V2 integration âœ…
  - [x] Emergency withdrawal functions âœ…
- [x] Prepare Launch Preflight Package (using LAUNCH_LIQUIDITY_PARAMS.md): âœ…
  - [x] Token pair: MIKO/SOL âœ…
  - [x] Raydium fee tier choice (0.25% standard) âœ…
  - [x] Initial price calculation âœ… (based on oracle price)
  - [x] Price range configuration for each stage âœ…
  - [x] Bootstrap liquidity amount (T0): 1% + 0.2 SOL âœ…
  - [x] Stage A amount (+60s): 4% + 0.8 SOL âœ…
  - [x] Stage B amount (+180s): 15% + 3.0 SOL âœ…
  - [x] Stage C amount (+300s): 70% + 6.0 SOL âœ…

#### Local-Fork Testing
- [ ] Create CLMM pool at T0
- [ ] Execute Launch Liquidity Ladder:
  - [ ] T+60s: Stage A liquidity add
  - [ ] T+180s: Stage B liquidity add
  - [ ] T+300s: Stage C liquidity add
- [ ] Monitor fee transitions:
  - [ ] 30% â†’ 15% at +5 minutes
  - [ ] 15% â†’ 5% at +10 minutes
- [ ] Test Harvest â†’ Swap â†’ Distribute cycle
- [ ] Test First Monday token change
- [ ] **VC:4.LOCAL_FORK_PASS**
  - [ ] Verify full launch path on local mainnet-fork
  - [ ] Test pool creation and 4-stage liquidity ladder
  - [ ] Verify fee schedule transitions (30% â†’ 15% â†’ 5%)
  - [ ] Test complete tax flow with real Jupiter swap
  - [ ] Write `verification/vc4-local-fork.json`
  - [ ] PASS required before Phase 5

## Phase 5: Launch Simulation & Mainnet Canary â³ AWAITING PHASE 4

**Testing Strategy**: Final validation using Mainnet Canary as per testing_strategy.md Section 4

### Mainnet Canary Setup
- [ ] Deploy programs with upgradeable flag
- [ ] Create token with minimal test supply
- [ ] Initialize all systems

### Mainnet Canary Launch
- [ ] Create Mainnet pool with â‰¤ 0.05 SOL liquidity
- [ ] Execute 4-stage Launch Liquidity Ladder
- [ ] Set launch timestamp immediately
  - [ ] **VC:LAUNCH_TIME_SET**
  - [ ] Write `verification/vc-launch-time-set.json`
- [ ] Monitor fee transitions:
  - [ ] 30% â†’ 15% at 5 minutes
  - [ ] 15% â†’ 5% at 10 minutes
  - [ ] **VC:FEE_TRANSITIONS_CONFIRMED**
  - [ ] Write `verification/vc-fee-transitions-confirmed.json`
- [ ] Execute Tax â†’ Swap â†’ Distribute cycle
- [ ] Run for minimum 30 minutes
- [ ] Execute at least 2 harvest cycles

### Canary Validation
- [ ] All systems functioning correctly
- [ ] No manual interventions required
- [ ] Ready for production scale-up

## Phase 6: Production Deployment â³ AWAITING PHASE 5

### Pre-deployment Checklist
- [ ] All tests passing
- [ ] All program IDs verified (declared = deployed)
- [ ] Anti-sniper features verified
- [ ] Tax flow scenarios tested
- [ ] Security audit complete
- [ ] Documentation finalized
- [ ] Infrastructure ready
- [ ] Monitoring configured

### Mainnet Deployment Process
- [ ] Generate NEW keypairs for mainnet programs *(optional - only if redeploying)*
- [ ] Update all declare_id! with mainnet addresses *(if using new keypairs)*
- [ ] Deploy programs in order:
  1. [ ] Deploy Absolute Vault with keypair
  2. [ ] Deploy Smart Dial with keypair
  3. [ ] Verify BOTH deployed IDs match declared IDs
- [ ] Create production token:
  - [ ] 30% initial fee
  - [ ] Freeze authority null
  - [ ] Mint total supply before any authority changes
- [ ] Initialize all systems in correct order:
  - [ ] Initialize vault first (creates PDA)
  - [ ] Initialize dial second
  - [ ] Verify all PDAs exist
  - [ ] Transfer authorities to Vault PDA
  - [ ] Revoke mint authority LAST

### Launch Execution
- [ ] Verify deployer wallet has all liquidity funds
- [ ] Create Raydium CLMM pool with bootstrap liquidity (refer to LAUNCH_LIQUIDITY_PARAMS.md)
- [ ] Execute Launch Liquidity Ladder:
  - [ ] T0: Bootstrap with minimal liquidity, narrow range
  - [ ] +60s: Stage A - narrow/midband liquidity add
  - [ ] +180s: Stage B - broader range, re-center if needed
  - [ ] +300s: Stage C - stability backstop
- [ ] **VC:LAUNCH_LIQUIDITY** (Production)
  - [ ] Verify each deployment within Â±5 seconds
  - [ ] Write `verification/vc-launch-liquidity-mainnet.json`
- [ ] Set launch timestamp IMMEDIATELY
- [ ] Start keeper bot
- [ ] Monitor fee updates precisely:
  - [ ] At launch + 5 minutes: 30% â†’ 15%
  - [ ] At launch + 10 minutes: 15% â†’ 5% (permanent)
- [ ] **VC:LAUNCH_TIMING** (Production)
  - [ ] Verify all transitions within Â±10 seconds
  - [ ] Write `verification/vc-launch-timing-mainnet.json`
- [ ] Monitor first 24 hours

### Success Metrics
- [ ] Snipers effectively deterred
- [ ] Fee transitions executed on time
- [ ] Program IDs all match (declared = deployed)
- [ ] Zero manual interventions required
- [ ] All fees harvested at threshold
- [ ] Rewards distributed after each harvest
- [ ] No security incidents

## Critical Checkpoints

Before proceeding to next phase, verify:

**After Phase 1**:
- Program keypairs generated BEFORE coding
- All declare_id! match deployed addresses
- Program IDs saved to shared-artifacts
- Direct CPI implementation working

**After Phase 2**:
- Total supply minted (1B MIKO)
- All tokens in deployer wallet
- Mint authority still with deployer
- Freeze authority null
- 30% initial fee active

**After Phase 3**:
- All programs initialized in order
- All PDAs exist before authority transfers
- Vault PDA has all authorities
- Mint authority revoked
- Tokens distributed to proper wallets
- Vault can harvest with PDA signature
- System accounts excluded
- SOL set as initial reward

**After Phase 4-A**:
- All modules developed
- Mock tests passing
- Edge cases handled
- Tax flow scenarios tested

**After Phase 4-B**:
- Local-Fork tests passing
- Launch script ready
- Real DEX integration verified
- Fee transitions working

**After Phase 5**:
- Mainnet Canary successful
- Multiple harvest cycles completed
- All VCs passed

## Common Issues and Solutions

1. **Program ID Mismatch**: ALWAYS generate keypair first, update declare_id!, then deploy
2. **Token-2022 CPI Issues**: Use direct invoke_signed
3. **Authority Problems**: Always verify before proceeding
4. **PDA Authority Timing**: Initialize programs to create PDAs BEFORE transferring authorities
5. **Mint Supply Timing**: Always mint total supply before revoking mint authority
6. **Launch Timing**: Set timestamp immediately after pool
7. **Liquidity Staging**: Deployer wallet controls all deployments
8. **Docker Networking**: Use shared-artifacts for data
9. **Rate Limits**: Implement proper retry logic
10. **Raydium CLMM Configuration**: 
    - Fee tier selection (0.25% standard, 1% exotic)
    - Manual price range adjustment per liquidity stage
    - Token-2022 requires user confirmation of transfer fee

## Launch Day Checklist

- [ ] All programs deployed with matching IDs
- [ ] Token created with 30% initial fee
- [ ] All programs initialized (PDAs exist)
- [ ] All authorities transferred correctly
- [ ] Deployer wallet has liquidity funds ready
- [ ] Keeper bot running and monitoring
- [ ] Launch script tested and ready
- [ ] Team ready for staged deployment
- [ ] Monitoring dashboard active
- [ ] Emergency procedures documented

This checklist ensures a perfect, production-ready implementation with robust anti-sniper protection through dynamic fees and Launch Liquidity Ladder.
